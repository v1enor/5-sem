# LAB 5

1. **Классифицируйте файлы СУБД Oracle 12c.**
    
    **Файл параметров**
    
    **Файл параметров –** файл параметров предназначен для хранения параметров экземпляра.
    
    **SPFILE**  - файл параметров сервера в двоичном виде.
    
    Может изменяться командой **ALTER SYSTEM … SCOPE=SPFILE**.
    
    Изменение параметров сохраняется в SPFILE и будет применяться при следующем старте Oracle.
    
    **Управляющие файлы**
    
    **Control files** – файлы, содержащие имена (местоположение) основных физических файлов базы данных и некоторых параметров. Используются для поиска других файлов операционной системы.
    
    Местоположение управляющих файлов экземпляр получает из файла параметров. По умолчанию для надежности создается 2 управляющих файла. Можно создать больше. Обычно их размещают на разных дисковых носителях (для надежности).
    
    **Файл паролей**
    
    ****Предназначен для аутентификации администраторов базы данных.
    
    **Файлы сообщений**
    
    ****Протоколы работы, трассировки, дампы.
    
2. **Перечислите структуры данных организованных в форме табличных пространств.**
    
    **Табличное пространство** – логическая структура хранения данных, контейнер сегментов.
    
    **Табличное пространство** – пограничный объект базы данных: с одной стороны, логическая структура сервера, с другой файл или файлы операционной системы. С одним табличным пространством связаны один или несколько файлов, с каждым файлом связано только одно табличное пространство.
    
    ***Данные, временные данные, данные отката*** – организованы в виде табличных пространств.
    
3. **Какие табличные пространства создаются при инсталляции Oracle 12с? Поясните их назначение.**
    
    **SYSTEM** используется для управления БД, содержит словарь базы данных, стандартные пакеты процедур.
    
    **SYSAUX** – вспомогательное табличное пространство.
    
    **TEMP** – временное табличное пространство по умолчанию.
    
    **UNDOTBS1** – табличное пространство отката.
    
    **USERS** – хранение пользовательских объектов и данных.
    
    **EXAMPLE** – демонстрационные схемы.
    
4. **Что означает свойство табличных пространств smallfile/bigfile?**
    
    **Smallfile** – 1022 файлов, по 222 блоков: для длительного использования.
    
    **Bigfile** – 1 файл, 128TB(блок 32К) или 32TB(блок 8К): для хранения одного большого файла данных.
    
    1. **Что означает свойство табличных пространств logging/nologging?**
    
    **Logging** ­– генерирует данные REDO во время обновления индекса / таблицы, вставки и удаления.
    
    **NOLOGGING** останавливает создание данных REDO во время обновления, вставки и удаления индекса / таблицы. Вы получите лучшую производительность, но вы не сможете восстановить данные.
    
5. **Что означает свойство табличных пространств offline/online?**
    
    Обычно мы переводим табличные пространства в автономный режим в целях обслуживания. Вы можете перевести онлайн-табличное пространство в автономный режим, чтобы оно было временно недоступно для общего использования. Остальная часть базы данных остается открытой и доступна пользователям для доступа к данным.
    
6. **Каким образом можно выяснить наименование применяемого инстансом Oracle 12c имя UNDO-табличного пространства?**
    
    Имя применяемого UNDO-табличного пространства расположено в файле параметров экземпляра. Ключ: .undo_tablespace.
    
7. **Что такое сегмент табличного пространства?**
    
    **Сегмент** – область на диске, выделяемая под объекты.Сегменты типизируются  в зависимости от типа данных, хранящихся в них – сегменты таблиц, сегменты индексов, сегменты кластеров и т.д.(всего 10 типов).
    
8. **Перечислите типы сегментов? Как получить все типы сегментов?**
9. **Удаляется ли (или сокращается) сегмент таблицы при удалении (DELETE) всех строк таблицы?**
    
    Сразу после создания таблицы сегмент не создается. Сегмент хранит только данные, поэтому он создается только при добавлении данных (в примере строки в таблицу). При удалении строк (delete) из таблицы, сегмент не удаляется.
    
10. **Что происходит с сегментом таблицы XXX_T1 при удалении ее оператором drop table XXX_T1?**
    
    При удалении таблицы (drop table) изменяется имя сегмента, и информация об удалении записывается в словарь базы данных.
    
11. **Поясните назначение представление USER_RECYCLEBIN.**
    
    Таблица и ее содержимое (сегмент) могут быть восстановлены с помощью механизма RECYCLEBIN.
    
12. **Что происходит с сегментом таблицы XXX_T1 при удалении ее оператором drop table XXX_T1 purge?**
    
    Для удаления RECYCLEBIN-сегмента применяется команда PURGE.
    
13. **Что такое экстент табличного пространства?**
    
    **Экстент** – непрерывный фрагмент дисковой памяти. Является единицей выделения вторичной памяти (выделяется целым числом экстентов). Когда экстент заполняется выделяется следующий. Размер экстента варьируется от одного блока до 2 Гб.
    
14. **Поясните назначение опции EXTENT MANAGEMENT LOCAL при создании табличного пространства.**
    
    Длину выделяемого экстента вычисляет СУБД (не меньше 64К). Управление экстентами возможно локальное **LOCAL** и через словарь базы данных **DICTIONARY**.
    
15. **Поясните назначение опции UNIFORM при создании табличного пространства.**
    
    Если при создании табличного пространства задана опция **UNIFORM**, то все экстенты имеют одинаковую длину.
    
16. **Что такое блок данных табличного пространства? Где и как задается его размер? Как выяснить размер блока?**
    
    **Блок** – минимальная единица объема памяти, применяемая при записи и чтении данных. Размер кратен 2К, и должен быть кратен величине блока операционной системы (2К, 4К, 8К, допустимы 16К, 32К). Устанавливается в файле параметров экземпляра при создании БД. В табличном пространстве все блоки одного размера.
    
17. **Для чего необходимы журналы повтора?**
    
    **Журналы повторного выполнения** - дисковые ресурсы, в которых фиксируются изменения вносимых пользователями в базу данных; журнал представляет собой файл операционной системы; как минимум должно быть два файла; журналы применяются при восстановлении базы данных.
    
18. **Поясните термины «мультиплекирование журналов повтора», «группа журналов повтора».**
    
    **Мультиплексирование журналов повтора** – поддержка несколько копий каждого журнала. Мультиплексирование файлов журналов повторного выполнения посредством помещения двух или более копий этих файлов на разные диски гарантирует, что вы не потеряете изменений данных, которые не были записаны в файлы данных.
    
    **Группа журналов повтора:** при заполнении файлов группы запись происходит в файлы другой группы.
    
19. **Какие параметры регламентируют максимальное количество групп журналов повтора и максимальное количество файлов в группе? Где эти параметры находятся? Каким образом их можно их посмотреть? Каким образом изменить?**
    
    Указывается в управляющих файлах:
    
    **MAXLOGFILES** - максимальное количество групп журналов повтора;
    
    **MAXLOGMEMBERS** - максимальное количество файлов в группе.
    
20. **Каким образом можно определить группу повтора, в настоящий момент используемую инстансом Oracle 12c?**
    
    Выполнить SELECT-запрос к словарю данных V$LOG. Поле STATUS.
    
21. **Расшифруйте аббревиатуру SCN. Что это такое. Каким образом можно проследить последовательность SCN в журналах повтора?**
    
    **SCN**  – System change number – системный номер изменений в базе данных. Выполнить SELECT-запрос к словарю данных V$LOG. Поле FIRST_CHANGE.
    
22. **Что такое архивы Oracle 12c? Каким образом можно проследить последовательность SCN в архивах и журналах повтора?**
    
    Если база данных работает в режиме **ARCHIVELOG**, перед перезаписью она сделает копию файлов оперативного журнала повтора. Затем эти архивированные файлы журнала повтора можно использовать для восстановления любой части базы данных в любой момент времени.
    
23. **Как выяснить выполняется ли архивирование инстансом или нет? Как включить архивирование и как выключить?**
    
    SELECT NAME, LOG_MODE FROM V$DATABASE;
    
    | Включить | Выключить |
    | --- | --- |
    | sql plus
    --connect /as sysdba
    --shutdown immediate;
    --startup mount;
    --alter database archivelog;
    --archive log list;
    --alter database open; | sql plus
    --connect /as sysdba
    --shutdown immediate;
    --startup mount;
    --alter database noarchivelog;
    --archive log list;
    --alter database open; |
24. **Как определить номер последнего архива? Как определить местоположение архивных файлов?**
    
    SELECT NAME, FIRST_CHANGE#, NEXT_CHANGE# FROM V$ARCHIVED_LOG;
    
25. **Что такое управляющие файлы Oracle 12c? Поясните, почему требуется мультиплексирование управляющих файлов. Где задано их количество и местоположение. Как получить их содержимое?**
    
    **Control files** – файлы, содержащие имена (местоположение) основных физических файлов базы данных и некоторых параметров. Используются для поиска других файлов операционной системы.
    
    Местоположение управляющих файлов экземпляр получает из файла параметров. По умолчанию для надежности создается 2 управляющих файла. Можно создать больше. Обычно их размещают на разных дисковых носителях (для надежности).
    
    $ORACLE_HOME \oradata\orcl – расположение;
    
    show parameter control – содержимое.
    
26. **Каким образом можно уменьшить/увеличить количество управляющих файлов.**
    
    Если надо изменить управляющий файл, то следует создать сценарий, откорректировать его и выполнить:
    
    - Остановить Oracle (shutdown transactional или immediate);
    - Скопировать один из управляющих файлов;
    - Изменить параметр CONTROL_FILES в файле параметров;
    - Стартовать Oracle (startup open).
27. **Что такое файл параметров? Как выяснить его местоположение? В чем разница между SPFILE и PFILE? Какая возможность появляется (приведите пример) при наличии бинарного формата файла параметров?**
    
    **Файл параметров** – файл параметров предназначен для хранения параметров экземпляра.
    
    **PFILE** - статичный, пользовательский текстовый файл, который редактируется стандартными текстовыми редакторами (например, "блокнот" или "vi"). Обычно этот файл находится на сервере, однако, для запуска Oracle с удаленной машины необходимо иметь локальную копию. АБД (Администраторы Баз Данных) обычно ссылаются на этот файл: INIT.ORA.
    
    **SPFILE** (Server Parameter File), с другой стороны, постоянно находящийся на сервере бинарный файл, который может быть изменен только с помощью команды "ALTER SYSTEM SET". Это значит, что больше нет необходимости хранить локальную копию файла параметров для запуска экземпляра с удаленной машины. Редактирование SPFILE-а вручную повредит его, после чего он станет неработоспособным.
    
28. **В какой последовательности инстанс ищет файлы параметров?**
29. **Каким образом можно получить PFILE из SPFILE? Каким образом можно получить SPFILE из PFILE?**
    
    CREATE SPFILE= filename FROM PFILE= filename
    
    CREATE PFILE=filename FROM SPFILE= filename
    
30. **Где находится файл паролей инстанса?**
    
    ORACLE_HOME/dbs
    
    ORACLE_HOME/database
    
31. **Каким образом можно выяснить местоположение файлов диагностики и сообщений?**
    
    SELECT * FROM V$DIAG_INFO;
    
32. **Что находится в файле LOG.XML?**
    
    Данный файл содержит все изменения, произведённые над базой данных.