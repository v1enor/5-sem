# LAB 15

1. **Перечислите типы триггеров, поддерживаемых Oracle.**
    
    **По привязанному объекту:**
    
    На таблице
    
    На представлении - instead of trigger
    
    **По событиям запуска:**
    
    Вставка записей - insert
    
    Обновление записей - update
    
    Удаление записей – delete
    
    **По области действия:**
    
    Уровень оператора - statement level triggers
    
    Уровень записи - row level triggers
    
    Составные триггеры  - compound triggers
    
    **По времени срабатывания:**
    
    Перед выполнением операции – before
    
    После выполнения операции - after
    
2. **Можно ли выполнять TCLоператоры в триггерах Oracle. Если да, то при каких условиях?**
    
    TCL–операторы нельзя выполнять в триггерах Oracle (исключение составляют триггеры, содержащие в себе автономные триггеры).
    
3. **Поясните правило: триггер является частью транзакции.**
    
    Триггер – часть транзакции, ошибка в триггере откатывает операцию, изменения таблиц в триггере становятся частью транзакции.
    
    Если откатывается транзакция, изменения триггера тоже откатываются.
    
4. **Перечислите привилегии необходимые для работы с триггерами.**
    
    **CREATE TRIGGER**  - создавать, удалять, изменять в своей подсхеме
    
    **CREATE ANY TRIGGER**  - создать любой триггер в любой схеме, кроме SYS, не рекомендуется для словаря, не разрешает менять текст триггера
    
    **ALTER ANY TRIGGER**  - разрешать, запрещать, изменять, компилировать, любые, кроме SYS-триггеров, триггеры
    
    **DROP ANY TRIGGER**  - удалять любой триггер, кроме SYS-триггеров
    
    **ADMINISTER DATABASE TRIGGER** - создавать, изменять, удалять системные триггеры, должен иметь привилегию CREATE TRIGGER или CREATE ANY TRIGGER
    
5. **Перечислите события, на которые могут срабатывать DMLтриггеры.**
    
    ![Untitled](LAB%2015/Untitled.png)
    
6. **Объясните, что такое BEFOREтриггеры и AFTERтриггеры.**
    
    AFTER (после события) –  после записи в журнал,
    
    BEFORE (до события) – до записи в журнал;
    
7. **В каких случаях нельзя обойтись только BEFOREтриггерами или только AFTERтриггерами?**
    
    Если вы меняете запись, на которую действует триггер, используйте триггер BEFORE. Если вы выполняете какую-то сложную логику, которая может предотвратить изменение записи, используйте триггер BEFORE.
    
    Почти во всем остальном используйте триггер AFTER. Примером может быть вставка дочерних записей, которые зависят от первичного ключа вставляемой записи. Например, если вы добавляете запись в таблицу истории для новой вставленной строки. Родительская строка не будет существовать в триггере BEFORE, поэтому проверка внешнего ключа не будет выполнена.
    
8. **Перечислите уровни срабатывания триггеров.**
    - операторные BEFORE;
    - для каждой строки BEFORE;
    - выполняется оператор;
    - для каждой строки AFTER;
    - операторные AFTER.
9. **Поясните принцип применения INSTEADOFтриггеров в Oracle.**
    
    Триггеры INSTEAD OF предназначены в PL/SQL для выполнения операций вставки, обновления и удаления элементов представлений базы данных Oracle, но не таблиц. С их помощью можно сделать необновляемое представление обновляемым и изменить поведение обновляемого пред­ставления по умолчанию.
    
10. **Что такое мутирование таблиц?**
    
    **Мутирование таблиц** (ошибка ORA-04091) возникает, если в триггере уровня строки выполняется изменение или чтение данных из той же самой таблицы, для которой данный триггер должен был сработать.