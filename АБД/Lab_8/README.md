# LAB 8

1. **Поясните принцип установления соединения с сервером Oracle по сети.**
    
    **Oracle Net** – программный компонент, который инициализирует, устанавливает и поддерживает подключения между клиентом и сервером.
    
    Состоит из двух компонентов:
    
    - **Oracle Network Foundation layer** – отвечает за установку и поддержание подключений между клиентским приложением и сервером.
    - **Oracle Protocol Support** – отвечает за отображение функциональности TNS (Transparent Network Substrate) на стандартные протоколы, используемые при подключении.
    
    Подключение к базе данных выполняется путем указания строки соединения, содержащей имя пользователя, пароль и дескриптор соединения.
    
    ---
    
    Для установления соединения на клиенте и сервере должен быть установлен Oracle Net, который за эти подключения и отвечает. Он состоит из двух компонентов: Oracle Network Foundation Layer (установка и поддержание соединений) и Oracle Protocol Support (отвечает за стандартные протоколы, например TNS).
    
    Если смотреть глубже, то для соединения клиента и сервера нам нужно:
    
    - клиент и сервер работают в сети
    - поддерживается TCP/IP
    - на сервере установлен Listener
    
    **Принцип установки соединения:**
    
    1. Listener прослушивает запросы клиентов
    2. Он же проверяет входящий запрос на подключение от клиента и проверяет, чтобы сервис клиента обладает достаточной инфой для коннекта (host, port, protocol)
    3. Далее он запрашивает у сервера установку соединения
    4. На сервер передается сервис клиента и проверяется подлинность юзернейма и пароля и прочих параметров сервиса
    5. Listener передает параметры соединения обратно клиенту
    6. После этого клиент и БД устанавливают соединение, и Listener отправляется обратно заниматься прослушиванием, ведь он никак не участвует в поддержке этого соединения
2. **Объясните назначение файлов SQLNET.ORA, TNSNAMES.ORA, LISTENER.ORA.**
    
    **TNSNAMES.ORA** – содержит дескрипторы подключения локальных именований.
    
    Файл **LISTENER.ORA** содержит информацию о конфигурации Listener Oracle. Поскольку служба слушателя действует только на сервере, клиентские компьютеры не содержат никакого файла **LISTENER.ORA**.
    
    **SQLNET.ORA** служит для управления выполнением служб Oracle Net
    
    ---
    
    SQLNET.ORA – сетевая конфигурация Listener’a. Тут указаны настройки шифрования, аутентификации, разграничение прав доступа к листенеру по айпишникам и т.д.
    LISTENER.ORA – отвечает за связь листенера с СУБД. Самые важные параметры – поле listener, в котором указаны host, port и protocol. То бишь на хосте с именем hostname на порте port_number запущен инстанс БД. Если получить этот файл, то можно спокойно обойти безопасность листенера.
    TNSNAMES.ORA – соответствие кратких имен (Net Service Names) и длинных дескрипторов соединений. Про это подробнее ниже.
    
3. **Какие виды соединений вы знаете? Кратко охарактеризуйте каждое из них.**
    
    **Простое подключение – Basic:**
    
    - Должны быть установлены Oracle Net Services
    - Поддержка протокола TCP/IP – на сервере и клиенте
    - Нельзя использовать расширенные сетевые функциональные возможности Oracle
    
    **Локальное именование – TNS**:
    
    - Требует файла Разрешения Имен на клиентской стороне
    - Поддерживает все протоколы Сети Oracle
    - Поддерживает продвинутые опции соединения, такие как:
        - Преодоление отказа во время соединения
        - Маршрутизация источника
        - Выравнивание нагрузки
    
    **LDAP-соединение:**
    
    **Local/bequeath-соединение:**
    
    - Только на сервере
    - Можно соединяться с помощью sqlplus или sqldeveloper
    - без указания параметров соединения
    - только с выделенным сервером
    - Listener не задействован
    - Соединение со стандартным сервисом SYS$USERS
    
    ---
    
    **Basic** – дефолтное; явно указываются все параметры подключения (username, password, host, port, sid/service_name)
    
    **TNS** – через локальное краткое именование; вводится только имя сетевого сервиса
    
    **LDAP** – используется протокол LDAP (Lightweight Directory Application Protocol).  Хуй в том, что сложная информация организуется в каталоги, часто сетевые – например, в сети расположен список пользователей, товаров, книг и т.д. Это упрощает поиск и доступ. Нужен специальный LDAP-сервер для такого коннекта.
    
    **Local/bequeath** – только на сервере, без указания остальных параметров соединения (хост, порт), вводится только юзер и пароль. Здесь не используется Listener. Такой же локальный коннект к самому себе, как и в SSMS.
    
4. **Что такое строка подключения?**
    
    Строка подключения содержит в себе имя пользователя, пароль, адрес, включающий название протокола, адрес хоста и порт, а также имя сервиса.
    
    ---
    
    К базе данных можно подключиться с помощью строки подключения. Утилита Net Manager помогает упростить создание этих строк благодаря созданию локального именования сервисов (аналогия DNS): вместо того, чтобы писать огромную строку подключения, в Net Manager можно задать все параметры (юзера, протокол, имя хоста, порт, имя сервиса, тип сервера) и задать всем этим данным именной псевдоним, который появится в файле tnsnames.ora. Далее можно подключаться по следующей строке: conn user/password@tnsname
    
5. **Что такое дескриптор подключения?**
    
    **Дескриптор соединения –** объединенная спецификация двух обязательных компонентов подключения к базе данных:
    
    - Имени службы базы данных
    - Местоположения адреса базы данных
    
    ---
    
    Дескрипторы соединения используются для объединения двух обязательных компонентов для подключения к базе данных: имени службы и ее адреса (местоположения). По сути, дескрипторы описаны в файле tnsnames.ora.
    DESCRIPTION обозначает сам дескриптор, ADRESS – адрес протокола (айпишник сервера или локалхост\порт, а также протокол), CONNECT_DATA – инфа для подключения (service_name или sid, а также опционально режим сервера – dedicated, shared или другой).
    Здесь адрес – это ADRESS, а имя службы – SERVICE_NAME.
    
6. **Расшифруйте аббревиатуру TNS.**
    
    **Протокол TNS (Transparent Network Substrate)** — уровень связи, используемый базами данных Oracle. Имя службы TNS — это имя, с которым экземпляр базы данных Oracle представлен в сети. Имя службы TNS назначается при настройке подключений к базе данных Oracle.
    
    ---
    
    Transparent Network Substrate. Находится в компоненте Oracle Protocol Support внутри Oracle Net, благодаря которому и устанавливается соединение между клиентом и сервером. Протокол TNS активно используется Ораклом для создания и установки подключений.
    
7. **Объясните назначение утилиты Oracle Net Manager.**
    
    Инструмент **Oracle Net Manager** может выполняться на клиентах и серверах, и он позволяет конфигурировать различные методы именования и слушателей. С помощью этого средства можно конфигурировать дескрипторы соединений в локальных файлах tnsnames.ora или в централизованном OID, а также легко добавлять и изменять методы подключения.
    
    ---
    
    Утилита помогает с помощью графического интерфейса создавать краткие имена (Net Service Names), соответствующие дескрипторам подключения.
    
8. **Перечислите все этапы запуска и останова экземпляра Oracle, поясните каждый этап.**
    
    **Запуск**
    
    1. **STARTUP NOMOUNT**: Запуск экземпляра Oracle без монтирования базы данных. Доступ пользователей запрещен. Используется для создания БД и пересоздания управляющих файлов;
    2. **STARTUP** **MOUNT:** Запустить экземпляр, монтировать БД, но не запускать ее. Считан файл параметров. Происходит обращение к управляющим файлам. Проверяется состояние файлов БД. Доступ пользователей запрещен. Из состояния STARTUP NOMOUNT переводится ALTER DATABASE MOUNT;
    3. **STARTUP** **OPEN:** Запустить экземпляр. Монтировать и открыть БД. Могут присоединяться пользователи. Из состояния STARTUP MOUNT переводится ALTER DATABASE OPEN.
    
    **Остановка**
    
    1. **SHUTDOWN** **NORMAL**: Запрещено создавать новые сессии. Ожидается завершение работы всех пользователей. Самый безопасный и долгий способ останова. Никаких восстановительных работ при следующем старте не проводится;
    2. **SHUTDOWN** **TRANSACTIONAL:** Запрещено создавать новые сессии. Запрещено запускать новые транзакции. Сервер дожидается завершения уже начатых транзакций и отключает пользователей, не имеющих активных транзакций. Применяется в случаях, когда нет возможности применить NORMAL. Никаких восстановительных работ при следующем старте не проводится.
    3. **SHUTDOWN** **IMMEDIATE:** Запрещено создавать новые сессии. Запрещено запускать новые транзакции. Все незафиксированные транзакции откатываются. Применяется в случаях, когда нет возможности ждать. Никаких восстановительных работ при следующем старте не проводится.
    4. **SHUTDOWN** **ABORT:** Применяется в крайних случаях, когда остальные режимы останова не приводят к результату. Все действия прекращаются. Все транзакции не фиксируются и не откатываются. Пользователей отсоединяют от БД. При следующем старте будет выполнено возможное восстановление.
9. **Какое имя группы пользователей Windows использует Oracle для администраторов.**
    
    **ora_dba**
    
    ORA_DBA. Оракл автоматически создает эту группу Windows-пользователей и добавляет туда учетную запись, которая использовалась при установке Оракла. Затем администратор БД может добавить в эту группу пользователей, которым нужен набор привилегий администратора.